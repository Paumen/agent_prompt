# Flow definitions — to be designed in a separate session.
# This file is the single source of truth for task/flow/step configuration.
# Claude implements exactly what is defined here.
#
# --- Vocabulary reference (pool for step definitions) ---
#
# Objects: repository, branch, file, folder, file tree, pull request, issue,
#   commit, PR comments, review comments, labels, diff hunks, CI status.
#
# Operations: read, create, edit, delete, rename, move, merge, split, search,
#   scan, compare, analyze, validate, commit, open (PR/issue).
#
# Focus Lenses: semantics, syntax, security, performance, structure,
#   dependencies, duplications, redundancies, error handling, naming conventions,
#   test coverage, type safety, documentation completeness, accessibility.
#
# --- Authoring guidelines ---
#
# - PR references use PR number only — don't embed diff content in the prompt.
#   The LLM has GitHub access and can fetch PR data using the number + PAT.
# - Write-oriented flows should instruct the LLM to create a new branch;
#   branch naming is left to the LLM's judgment if not specified by the user.
# - Step granularity should be moderate — assume LLM competence.
#   Don't micro-instruct what it already knows how to do.

flows:
  fix:
    label: 'Fix / Debug'
    icon: 'bug'
    panel_a:
      label: 'Current State' # or per naming option chosen
      subtitle: "What's happening now"
      fields:
        description:
          type: text
          placeholder: 'Describe the issue: error messages, unexpected behavior, what goes wrong...'
          required_group: a_required
        issue_number:
          type: issue_picker
          placeholder: 'Select GitHub issue'
          required_group: a_required
        files:
          type: file_picker_multi
          placeholder: 'Where does it occur?'
    panel_b:
      label: 'Expected Outcome'
      subtitle: 'How it should work after the fix'
      fields:
        description:
          type: text
          placeholder: 'Describe the expected behavior after the fix is applied...'
        spec_files:
          type: file_picker_multi
          placeholder: 'Requirements or spec file'
        guideline_files:
          type: file_picker_multi
          placeholder: 'Style guides or coding standards'
    steps:
      - id: read-claude
        operation: read
        object: file
        params: { file: 'claude.md' }
      - id: read-location
        operation: read
        object: files
        source: panel_a.files # conditional: only if files selected
      - id: read-issue
        operation: read
        object: issue
        source: panel_a.issue_number # conditional: only if issue selected
      - id: read-specs
        operation: read
        object: files
        source: panel_b.spec_files # conditional 
      - id: read-guidelines
        operation: read
        object: files
        source: panel_b.guideline_files  # conditional
      - id: identify-cause
        operation: analyze
        object: issue
        lenses: [error_handling, semantics,...]
      - id: create-branch
        operation: create
        object: branch
        branche_name: [let llm decide (default), text input filed (Optional)]
      - id: implement-fix
        operation: edit
        object: files
        lenses: [error_handling, semantics,...]
      - id: run-tests
        operation: validate
        object: tests
      - id: commit-pr
        operation: commit
        object: changes
        params: { open_draft_pr: true }

  review:
    label: 'Review / Analyze'
    icon: 'search'
    panel_a:
      label: 'Review Subject'
      subtitle: 'The PR, code, or document to examine'
      fields:
        description:
          type: text
          placeholder: 'Background, specific questions, or areas of concern...'
        pr_number:
          type: pr_picker
          placeholder: 'Select a pull request'
          required_group: a_required
        files:
          type: file_picker_multi
          placeholder: 'Files to review'
          required_group: a_required
    panel_b:
      label: 'Review Criteria'
      subtitle: 'Standards and criteria for the review'
      fields:
        lenses:
          type: lens_picker
          default: [semantics, structure,...]
        spec_files:
          type: file_picker_multi
          placeholder: 'specs to meet'
        guideline_files:
          type: file_picker_multi
          placeholder: 'Standards to check'
    steps:
      - id: read-claude
        operation: read
        object: file
        params: { file: 'claude.md' }
      - id: read-specs
        operation: read
        object: files
        source: panel_b.spec_files
      - id: read-guidelines
        operation: read
        object: files
        source: panel_b.guideline_files
      - id: review-pr
        operation: analyze
        object: pull_request
        source: panel_a.pr_number
        lenses: [] # populated from panel_b.lenses
      - id: review-files
        operation: analyze
        object: files
        source: panel_a.files
        lenses: [] # populated from panel_b.lenses
      - id: provide-feedback
        operation: create
        object: review_feedback

  implement:
    label: 'Implement / Build'
    icon: 'plus'
    panel_a:
      label: 'Context'
      subtitle: 'Existing code or context to build upon (optional)'
      fields:
        description:
          type: text
          placeholder: 'Background, constraints, or existing context...'
        files:
          type: file_picker_multi
          placeholder: 'Existing files to build upon'
    panel_b:
      label: 'Requirements'
      subtitle: 'What to build and completion criteria'
      fields:
        description:
          type: text
          required: true
          placeholder: 'Describe what to build: functionality, behavior, constraints, requirements/spec id...'
        spec_files:
          type: file_picker_multi
          placeholder: 'Requirement docs, user stories, technical specs'
        acceptance_criteria:
          type: text
          placeholder: "How to know it's done: test cases, edge cases, quality standards..."
    steps:
      - id: read-claude
        operation: read
        object: file
        params: { file: 'claude.md' }
      - id: read-starting
        operation: read
        object: files
        source: panel_a.files
      - id: read-specs
        operation: read
        object: files
        source: panel_b.spec_files
      - id: create-branch
        operation: create
        object: branch
      - id: implement
        operation: create
        object: implementation
        lenses: [semantics, structure]
      - id: verify-criteria
        operation: validate
        object: acceptance_criteria
        source: panel_b.acceptance_criteria
      - id: run-tests
        operation: validate
        object: tests
      - id: commit-pr
        operation: commit
        object: changes
        params: { open_pr: true }

  improve:
    label: 'Improve / Modify'
    icon: 'arrow-up'
    panel_a:
      label: 'Current State'
      subtitle: 'What exists and what needs improvement'
      fields:
        description:
          type: text
          placeholder: 'What to enhance: pain points, inefficiencies, areas to improve...'
          required_group: a_required
        issue_number:
          type: issue_picker
          placeholder: 'Select a related GitHub issue'
          required_group: a_required
        files:
          type: file_picker_multi
          placeholder: 'Files to improve'
    panel_b:
      label: 'Desired Outcome'
      subtitle: 'What the improved version should look like'
      fields:
        lenses:
          type: lens_picker
          default: []
        description:
          type: text
          placeholder: 'Describe the desired improvements, goals, or constraints...'
        issue_number:
          type: issue_picker
          placeholder: 'Issue describing the desired state'
        guideline_files:
          type: file_picker_multi
          label: 'Reference files'
          placeholder: 'Style guides, examples of desired output, or specs'
    multi_file:
      scope_selector:
        label: 'How should files be improved?'
        options:
          each_file: 'Each file separately'
          across_files: 'Across files together'
        show_when: 'panel_a.files.length >= 2'
    steps:
      - id: read-claude
        operation: read
        object: file
        params: { file: 'claude.md' }
      - id: read-files
        operation: read
        object: files
        source: panel_a.files
      - id: read-issue-current
        operation: read
        object: issue
        source: panel_a.issue_number
      - id: read-issue-desired
        operation: read
        object: issue
        source: panel_b.issue_number
      - id: read-references
        operation: read
        object: files
        source: panel_b.guideline_files
      - id: create-branch
        operation: create
        object: branch
      - id: apply-improvements
        operation: edit
        object: files
        lenses: [] # populated from panel_b.lenses
      - id: verify
        operation: validate
        object: improvements
      - id: commit-pr
        operation: commit
        object: changes
        params: { open_pr: true }
